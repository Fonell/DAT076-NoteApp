<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:head>
        <title>Start Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"></link>
        <link rel="stylesheet" href="darkmode.css"></link>
    </h:head>

    <h:body>

        <p:commandLink class="pi pi-plus-circle" style="font-size: 2rem; color: white; text-decoration: none" update="mainForm" oncomplete="PF('addEventDialog').show()"/>

        <p:dialog header="Add event" widgetVar="addEventDialog" modal="false" draggable="false" resizable="false" responsive="true" closeOnEscape="true">
            <h:form>
                <p:panelGrid id="formPanel" columns="2">

                    <p:outputLabel for="eventName" value="Name"/>
                    <p:inputText id="eventName" value="#{calendarBean.eventName}" autocomplete="off"/>

                    <p:outputLabel for="eventText" value="Text"/>
                    <p:inputText id="eventText" value="#{calendarBean.eventText}" autocomplete="off"/>

                    <p:datePicker value="#{calendarBean.date}" />

                </p:panelGrid>

                <p:commandButton value="save" action="#{calendarBean.createEvent()}" update="mainForm" process="@form" oncomplete="PF('addEventDialog').hide();"/>
            </h:form>
        </p:dialog>


        <h:form id="searchForm">
            <p:outputLabel for="searchString" value="Search"/>
            <p:inputText id="searchString" value="#{searchBean.searchString}" autocomplete="off"/>

            <h:panelGroup layout="block" class="card" rendered="#{!searchBean.searchString.blank}">

                <p>Search results for: #{searchBean.searchString}</p>

                <ui:repeat var="event" value="#{searchBean.eventsByName}">
                    <div class="card">
                        <p>#{event.name}</p>
                        <p>#{event.hour} : #{event.min}</p>
                        <p>#{event.text}</p>
                        <h:commandLink value = "Delete" action = "#{calendarBean.deleteEvent(event)}"/>
                    </div>
                </ui:repeat>
            </h:panelGroup>

        </h:form>




        <h:form id="mainForm">
            
            <ui:repeat var="year" value="#{calendarBean.events}">
                <div class="card">
                    <p>#{year.integerRepresentation}</p>

                    <ui:repeat var="month" value="#{year.months}">
                        <div class="card">
                            <p>#{month.stringRepresentation} #{month.integerRepresentation}</p>


                            <ui:repeat var="week" value="#{month.weeks}">
                                <div class="card">
                                    <p>Week: #{week.integerRepresentation}</p>


                                    <ui:repeat var="day" value="#{week.days}">
                                        <div class="card">
                                            <p>#{day.stringRepresentation} #{day.integerRepresentation}</p>

                                            <ui:repeat var="event" value="#{day.events}">
                                                <div class="card">

                                                    <p:inplace editor="true">
                                                        <p:ajax event="save" listener="#{calendarBean.update(event)}" update="mainForm"/>
                                                        <h:inputText value="#{event.name}" />
                                                    </p:inplace>
                                                    
                                                    <p:inplace editor="true">
                                                        <p:ajax event="save" listener="#{calendarBean.update(event)}" update="mainForm"/>
                                                        <h:inputText value="#{event.text}" />
                                                    </p:inplace>

                                                    <p>#{event.hour} : #{event.min}</p>
                                                    

                                                    <h:commandLink value = "Delete" action = "#{calendarBean.deleteEvent(event)}"/>
                                                </div>  
                                            </ui:repeat>
                                        </div>    
                                    </ui:repeat>
                                </div>    
                            </ui:repeat>
                        </div>    
                    </ui:repeat>
                </div>
            </ui:repeat>
        </h:form>

    </h:body>
</html>